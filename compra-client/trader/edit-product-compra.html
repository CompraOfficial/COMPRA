<!DOCTYPE html><!--  This site was created in compra. https://www.compra.com  -->
<!--  Last Published: Wed Sep 28 2022 21:20:21 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="62da9e4a5e4a272bad2f00cf" data-wf-site="62da9e495e4a27647f2f00aa" lang="en">
<head>
  <meta charset="utf-8">
  <title>Edit Product | COMPRA</title>
  <meta content="Startup Template - compra Responsive Website Template" name="description">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="compra" name="generator">
  <link href="../css/normalize.css" rel="stylesheet" type="text/css">
  <link href="../css/compra.css" rel="stylesheet" type="text/css">
  <link href="../css/compra-client.compra.css" rel="stylesheet" type="text/css">
  <!-- [if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" type="text/javascript"></script><![endif] -->
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="../images/favicon.jpg" rel="shortcut icon" type="image/x-icon">
  <link href="../images/webclip.jpg" rel="apple-touch-icon">

  <!-- modal -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
  
  <!-- Local Routing -->
  <script src="../js/local_routes.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

  <script>
    $(document).ready(function(){
      let params = new URLSearchParams(location.search);
      var pId = params.get('pId');

      var dataForm = new FormData();
      dataForm.append("pId", pId);
      var xhr = new XMLHttpRequest();
      xhr.open("POST", TRADER_API.PRODUCT);
      xhr.onload = function(){
        var result = JSON.parse(this.response)
        console.log(result)

        $("#pName").val(result.product_name);
        $('#pCat').val(result.category);
        $('#pType').val(result.product_type);
        $('#pMois').val(result.moisture);
        $('#pAge').val(result.age);
        $('#pUniMea').val(result.unit_measurement);
        $('#pPrice').val(result.price);
        $('#pStocks').val(result.stock);
        $('#pDelFeeIn').val(result.deli_fee_within);
        $('#pDelFeeOut').val(result.deli_fee_outside);
        $('#pDesc').val(result.description);
        if(result.img1 != ""){
          $('#pImg1').attr('src','http://localhost/compra/compra-backend/api/trader/uploads/products/' + result.img1);
        }
        if(result.img2 != ""){
          $('#pImg2').attr('src','http://localhost/compra/compra-backend/api/trader/uploads/products/' + result.img2);
        }
        if(result.img3 != ""){
          $('#pImg3').attr('src','http://localhost/compra/compra-backend/api/trader/uploads/products/' + result.img3);
        }
        if(result.img4 != ""){
          $('#pImg4').attr('src','http://localhost/compra/compra-backend/api/trader/uploads/products/' + result.img4);
        }

        if(result.status == 'DELETED'){
          $('h1').html("Edit "+result.status+" Product");
          $('#deleteBtn').hide();
          $('#updateBtn').hide();
        }else{
          $('#undeleteBtn').hide();
        }

      }
      xhr.send(dataForm); 
    })
  </script>
</head>
<body>
  <!-- navbar -->
  <div class="navbar abs-top buyer trader">
    <div class="container">
      <div class="nav-content">
        <div class="nav-left-content"><img src="../images/noname123.png" loading="lazy" alt="" class="nav-logo">
          <a href="../trader/trader-home-compra.html" aria-current="page" class="nav-link w--current">Home</a>
          <a href="../trader/product-inventory-compra.html" class="nav-link">Products</a>
          <a href="../trader/order-inventory-compra.html" class="nav-link">orders</a>
          <a href="../trader/" class="nav-link">Bidding</a>
          <a href="../trader/" class="nav-link">Subscription</a>
        </div>
        <div class="nav-right-content">
          <a href="../buyer/notification-compra.html" class="nav-link fa-icon"></a>
          <div data-w-id="7f2630d3-30e5-6c47-deea-6ca782ebb2ed" class="profile-dropdown">
            <a href="#" class="nav-link mr-0 fa-icon"></a>
            <div class="dropdown-content">
              <div class="flex-v">
                <div class="setting-cat">user settings</div>
                <a href="../trader/edit-profile-compra.html" class="content-vcenter no-dec mb-2 w-inline-block">
                  <div class="profile-pic mr-1"><img src="../images/360_F_64676383_LdbmhiNM6Ypzb3FM4PPuFP9rHe7ri8Ju.jpg" loading="lazy" alt="" class="profile-image"></div>
                  <div>
                    <div class="us-name">[Full name]</div>
                    <div class="text-gray small-text">Edit Profile Details</div>
                  </div>
                </a>
              </div>
              <a href="../trader/chat-compra.html" class="content-vcenter mb-1 no-dec w-inline-block">
                <div class="us-icon">
                  <img src="https://d3e54v103j8qbb.cloudfront.net/plugins/Basic/assets/placeholder.60f9b1840c.svg" loading="lazy" alt="" class="image stretch-flow">
                </div>
                <div>
                  <strong class="black-text">Chats</strong>
                </div>
              </a>
              <a href="#" class="content-vcenter mb-1 no-dec w-inline-block">
                <div class="us-icon">
                  <img src="https://d3e54v103j8qbb.cloudfront.net/plugins/Basic/assets/placeholder.60f9b1840c.svg" loading="lazy" alt="" class="image stretch-flow">
                </div>
                <div>
                  <strong class="black-text">Order History</strong>
                </div>
              </a>
              <a href="../trader/edit-pick-up-info-compra.html" class="content-vcenter mb-1 no-dec w-inline-block">
                <div class="us-icon">
                  <img src="https://d3e54v103j8qbb.cloudfront.net/plugins/Basic/assets/placeholder.60f9b1840c.svg" loading="lazy" alt="" class="image stretch-flow">
                </div>
                <div>
                  <strong class="black-text">Pick-up Info</strong>
                </div>
              </a>
              <a href="#" class="content-vcenter no-dec w-inline-block">
                <div class="us-icon">
                  <img src="https://d3e54v103j8qbb.cloudfront.net/plugins/Basic/assets/placeholder.60f9b1840c.svg" loading="lazy" alt="" class="image stretch-flow">
                </div>
                <div>
                  <strong class="black-text">Logout</strong>
                </div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- edit product section -->
  <div class="section small">
    <div class="container">
      <div>

        <a href="../trader/product-inventory-compra.html" class="back-link"><span class="fa-icon"></span> Back</a>

        <h1 class="h1 gen">Edit Product</h1>

        <div class="grid-2 addproduct mb-1">
          <div id="w-node-_573d2167-f4d0-c0b5-629f-5443a903a59d-cf2f00d5">
            <div class="w-form">

              <div id="email-form">
                <div class="grid-2 mb-1">

                  <input type="text" id="pName" name="pName" oninput="this.value = this.value.replace(/[^a-zA-Z0-9 .,]/g, '').replace(/(\..*)\./g, '$1');" class="text-field mb-0 w-input" maxlength="256" placeholder="Product Name" required="">

                  <select id="pCat" name="pCat" required="" class="text-field mb-0 w-node-_62881bae-1464-37f6-3299-5543a99221bb-cf2f00d5 w-select">
                    <option value="Copra">Copra</option>
                  </select>

                  <select id="pType" name="pType" required="" class="text-field mb-0 w-node-_62881bae-1464-37f6-3299-5543a99221bc-cf2f00d5 w-select">
                    <option value="Dried Copra">Dried Copra</option>
                    <option value="Cooked Copra">Cooked Copra</option>
                  </select>

                  <select  id="pMois" name="pMois" required="" class="text-field mb-0 w-node-_62881bae-1464-37f6-3299-5543a99221bc-cf2f00d5 w-select">
                    <option value="none">None</option>
                    <option value="1% - 25%">Moisture Content: 1% - 25%</option>
                    <option value="26% - 50%">Moisture Content: 26% - 50%</option>
                    <option value="51% - 75%">Moisture Content: 51% - 75%</option>
                    <option value="76% - 100%">Moisture Content: 76% - 100%</option>
                  </select>

                  <input type="text" id="pAge" name="pAge" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');" class="text-field mb-0 w-input" maxlength="3"placeholder="Age (by month)" required="">
                  
                  <select id="pUniMea" name="unit_measure" required="" class="text-field mb-0 w-node-_62881bae-1464-37f6-3299-5543a99221bf-cf2f00d5 w-select">
                    <option value="Quantity">Quantity</option>
                    <option value="Kilogram">Kilogram</option>
                    <option value="Liter">Liter</option>
                  </select>

                  <input type="number" id="pPrice" name="pPrice" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" class="text-field mb-0 w-input" maxlength="10"placeholder="Price Per Unit" required="">
                  <input type="text" id="pStocks" name="pStocks" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');" class="text-field mb-0 w-input" maxlength="10"placeholder="Stocks" required="">
                  <input type="text" id="pDelFeeIn" name="pDelFeeIn" oninput="this.value = this.value.replace(/[^0-9]./g, '').replace(/(\..*)\./g, '$1');" class="text-field mb-0 w-input" maxlength="10"placeholder="Delivery fee within your area" required="">
                  <input type="text" id="pDelFeeOut" name="pDelFeeOut" oninput="this.value = this.value.replace(/[^0-9]./g, '').replace(/(\..*)\./g, '$1');" class="text-field mb-0 w-input" maxlength="10" placeholder="Delivery fee outside your area" required="">
                </div>

                <textarea placeholder="Description" id="pDesc" name="pDesc"  maxlength="5000"  class="text-field textarea w-input"></textarea>

              </div>
              
            </div>
          </div>

          <div id="w-node-b27c2fcc-7a9b-e7b3-ba82-b759b4d5e31f-cf2f00d5">
            <div class="content-hbetween mb-2">
              <h2 class="h2 ap-img">Product Images:</h2>
              <button onclick="removeAllImgs()" class="button w-button">Remove all images</button>
            </div>
            
            <div class="grid-3 ap">

              <label for="img1" id="w-node-_8c8840be-705e-213c-7e62-4757957b0570-cf2f00d5" class="p-img-cont" style="cursor: pointer">
                <img id="pImg1" src="../images/blank-1.svg" loading="lazy" alt="" class="p-image-ap">
                <input type="file" id="img1" name="img1"  onchange="changeImg(event, '1')" accept="image/png, image/jpeg" style="opacity: 0;">
              </label>

              <label for="img2" id="w-node-_8c8840be-705e-213c-7e62-4757957b0570-cf2f00d5" class="p-img-cont" style="cursor: pointer">
                <img id="pImg2" src="../images/blank-1.svg" loading="lazy" alt="" class="p-image-ap">
                <input type="file" id="img2" name="img2" onchange="changeImg(event, '2')" accept="image/png, image/jpeg" style="opacity: 0;">
              </label>

              <div id="w-node-_6bf4466c-2b1c-ca01-3746-e4fe5167d502-cf2f00d5" class="grid-row-2">

                <label for="img3" id="w-node-_8c8840be-705e-213c-7e62-4757957b0570-cf2f00d5" class="p-img-cont small" style="cursor: pointer">
                  <img id="pImg3" src="../images/blank-1.svg" loading="lazy" alt="" class="p-image-ap">
                  <input type="file" id="img3" name="img3" onchange="changeImg(event, '3')" accept="image/png, image/jpeg" style="opacity: 0;">
                </label>
  
                <label for="img4" id="w-node-_8c8840be-705e-213c-7e62-4757957b0570-cf2f00d5" class="p-img-cont small" style="cursor: pointer">
                  <img id="pImg4" src="../images/blank-1.svg" loading="lazy" alt="" class="p-image-ap">
                  <input type="file" id="img4" name="img4" onchange="changeImg(event, '4')" accept="image/png, image/jpeg" style="opacity: 0;">
                </label>
  
              </div>

            </div>
            
          </div>
        </div>

        <div class="content-vcenter">
          <a href="#" onclick="deleteProduct()" id="deleteBtn" class="button w-button report mr-2"><span class="fa-icon"></span> DELETE PRODUCT</a>
          <a href="#" onclick="editProduct()" id="updateBtn" class="button w-button"><span class="fa-icon"></span> SAVE PRODUCT</a>
          <a href="#" onclick="editProduct()" id="undeleteBtn" class="button w-button"><span class="fa-icon"></span> UNDELETE PRODUCT</a>
        </div>
      </div>
    </div>
  </div>


  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=62da9e495e4a27647f2f00aa" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="../js/compra.js" type="text/javascript"></script>
  <!-- [if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif] -->
</body>

<script>
  function deleteProduct(){
    if (confirm('Are you sure you want to delete this product?')) {
      var dataForm = new FormData();

      let params = new URLSearchParams(location.search);
      var pId = params.get('pId');

      dataForm.append("pId", pId);

      var xhr = new XMLHttpRequest();
      xhr.open("POST", TRADER_API.DELETE_PRODUCT);
      xhr.onload = function(){
        console.log(this.response)
        alert(this.response)
        location.reload()
      }
      xhr.send(dataForm);
      
    }
  }

  function removeAllImgs(){
    var dataForm = new FormData();

    let params = new URLSearchParams(location.search);
    var pId = params.get('pId');

    dataForm.append("pId", pId);

    var xhr = new XMLHttpRequest();
    xhr.open("POST", TRADER_API.DELETE_PRODUCT_IMGS);
    xhr.onload = function(){
      console.log(this.response)
      alert(this.response)
    }
    xhr.send(dataForm);

  }

  function changeImg(event, imgTag){
    $('#pImg'+imgTag).attr("src", URL.createObjectURL(event.target.files[0]));
    
    var dataForm = new FormData();

    let params = new URLSearchParams(location.search);
    var pId = params.get('pId');
    dataForm.append("pId", pId);
    dataForm.append("img", $('#img'+imgTag).get(0).files[0]);
    dataForm.append("tag", imgTag);

    var xhr = new XMLHttpRequest();
    xhr.open("POST", TRADER_API.EDIT_PRODUCT_IMG);
    xhr.onload = function(){
      console.log(this.response)
      alert(this.response)
    }
    xhr.send(dataForm);
  }
  
  function editProduct(){
    var pName = $("#pName").val();
    if(pName == ""){
      alert('Needs Product Name')
      return;
    }
    var pCat = $('#pCat').val();
    var pType = $('#pType').val();
    var pMois = $('#pMois').val();
    var pAge = $('#pAge').val();
    if(pAge == ""){
      alert('Needs Product Age')
      return;
    }
    var pUniMea = $('#pUniMea').val();
    var pPrice = $('#pPrice').val();
    if(pAge == ""){
      alert('Needs Product Price Per Unit')
      return;
    }
    var pStocks = $('#pStocks').val();
    if(pStocks == ""){
      alert('Needs Product Available Stocks')
      return;
    }
    var pDelFeeIn = $('#pDelFeeIn').val();
    if(pStocks == ""){
      alert('Needs Product Delivert Fee Within the same area')
      return;
    }
    var pDelFeeOut = $('#pDelFeeOut').val();
    if(pStocks == ""){
      alert('Needs Product Delivert Fee Outside the same area')
      return;
    }
    var pDesc = $('#pDesc').val();

    var dataForm = new FormData();

    let params = new URLSearchParams(location.search);
    var pId = params.get('pId');
    dataForm.append("pId", pId);
    dataForm.append("pName", pName);
    dataForm.append("pCat", pCat);
    dataForm.append("pType", pType);
    dataForm.append("pMois", pMois);
    dataForm.append("pAge", pAge);
    dataForm.append("pUniMea", pUniMea);
    dataForm.append("pPrice", pPrice);
    dataForm.append("pStocks", pStocks);
    dataForm.append("pDelFeeIn", pDelFeeIn);
    dataForm.append("pDelFeeOut", pDelFeeOut);
    dataForm.append("pDesc", pDesc);

    var xhr = new XMLHttpRequest();
    xhr.open("POST", TRADER_API.EDIT_PRODUCT);
    xhr.onload = function(){
      console.log(this.response)
      alert(this.response)
      location.reload();
    }
    xhr.send(dataForm);
  }
  
  $(document).ready(function(){

    
  })

</script>

</html>